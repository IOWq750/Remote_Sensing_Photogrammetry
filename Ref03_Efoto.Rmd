# Стереоизмерения {#stereo}

## Установка программного обеспечения {#stereo-soft}
[В начало справки ⇡](#stereo)


Для практической работы вам понадобится открытая учебная фотограмметрическая программа **E-foto**. Информацию о ней можно найти на домашнем сайте (http://www.efoto.eng.uerj.br/), там же можно скачать себе дистрибутив программы. Для этого перейдите во вкладку **DOWNLOAD – Latest Version**


![Страница для загрузки программы и данных](images\Ref03\Download.png)


Запустите скачанный пакет установщика и установите программу.

## Исходные данные {#stereo-initial}
[В начало справки ⇡](#stereo)

В качестве исходных данных мы будем использовать серию аэрофотоснимков с перекрытием на территорию окрестностей УНС Сатино, сделанную в 1970 году, а также сеть опорных точек и топографическую карту.

[Снимки](https://yadi.sk/d/x7V_hMkPuviJVw){target="_blank"}

[Наземные опорные точки](https://yadi.sk/d/gEQC2jcCFJGifA){target="_blank"}

[Топографическая карта масштаба 1:10 000](https://yadi.sk/i/XM7Z30SZcvy6IA){target="_blank"}

## Создание проекта {#stereo-create_project}
[В начало справки ⇡](#stereo)

Запустите программу **E-foto**. В меню выберите **Project – New**. Укажите путь для сохранения файла проекта с расширением **.epp**.

Откроется окно менеджера проекта. Слева приведена структура проекта, а по центру - содержание. В разделе **Project Header** вам нужно указать общую информацию о проекте. Для этого включите режим редактирования, нажав на кнопку **Edit** внизу страницы.


![Окно менеджера проекта](images\Ref03\Project_Manager.png)


Перейдите в раздел **Terrain** и укажите общую информацию о территории.

_Максимальная высота_ – 200 м

_Минимальная высота_ – 133 м

_Средняя высота_ – 167 м

_Зона UTM_ – 37

Примерную широту и долготу центра территории укажите, используя программу **Google Earth** и точки фототриангуляции. Не забудьте указать правильные полушария.

Перейдите в раздел **Sensor** и укажите общую информацию о съёмке.

_Калиброванное фокусное расстояние аэрофотоаппарата_ – 96.78 мм.

_Координаты главной точки_ – x = 0.5, y = 0.4.

Информации о параметрах дисторсии камеры у нас нет.

Укажите координаты координатных меток снимков (**Fiducial marks**) в последней таблице.

![Координаты меток](images\Ref03\Fiducial.png)


В разделе **Flight** мы можем указать примерную высоту съёмку – 1500 м, а также примерный масштаб снимков 1:14 000.

В разделе **images** нужно загрузить аэрофотоснимки, указав их разрешение – **600 dpi**. Вы можете после этого открыть раздел с каждым из загруженных снимков и увидеть информацию о нём.

![Параметры снимка](images\Ref03\Image.png)


В этом разделе нажмите на кнопку **View Image** для просмотра изображения. Если при открытии изображения возникла ошибка, то, скорее всего, у вас неправильно записались пути в файле проекта. Обратите внимание на снимок экрана выше – в строке пути должен быть указан путь, в строке имени файла - только его имя, а в строке ID снимка достаточно указать имя файла без расширения. Исправить это внутри программы нельзя, но, к счастью, файл проекта – это документ XML, который редактируется блокнотом. Найдите внутри него соответствующие теги и исправьте содержимое внутри них.


![Параметры снимка](images\Ref03\XML_editing.png)


## Внутреннее ориентирование {#stereo-interior}
[В начало справки ⇡](#stereo)

Для выполнения внутреннего ориентирования снимков выберите пункт меню **Execute – Interior Orientation**. В открывшемся окне предлагается выбрать снимок для ориентирования. Необходимо последовательно выполнить эту операцию для всех снимков. Для масштабирования можно использовать инструмент лупы, который работает на выделяемую прямоугольную область. Для произвольного изменения масштаба в обе стороны нужно зажать колёсико мыши. Координатные метки рассматриваемых снимков расположены возле края середины каждой из сторон и представляют собой асимметричные кресты, которые по размеру больше, чем обычные регулярные кресты, идущие с шагом в 1 см.


![Координатная метка снимка](images\Ref03\Mark.png)


Обратите внимание на порядок координатных меток – правая, левая, верхняя, нижняя. Вам нужно расставлять их в таком же порядке. Внизу окна приводится табличка, где выделена строка с активной на данной момент меткой. Как только вы метку установили, автоматически активной становится следующая метка в таблице. Если вам необходимо исправить положение координатной метки, то нужно выделить соответствующую строку в таблице и указать на снимке правильное положение метки.

После расстановки меток нажмите на кнопку ![](images\Ref03\Execute_IO.png). В результате откроется окно отчёта внутреннего ориентирования с вектором параметров и матрицей вариации-ковариации. Если точность операции удовлетворительная, то будет активна кнопка **Accept**, нажав которую, мы сохраняем параметры. После этого нажмите на кнопку **Done** ![](images\Ref03\Done.png), что вернёт вас в основное окно проекта.


![Отчёт внутреннего ориентирования](images\Ref03\IO_Report.png)


Аналогично операция проделывается для всех снимков.


## Опорные точки {#stereo-GCP}
[В начало справки ⇡](#stereo)

Поскольку параметры внешнего ориентирования нам заранее неизвестны, то их необходимо рассчитать на основе обратной фотограмметрической засечки. Для обратной засечки нам потребуются опорные точки с известными координатами и высотами. Откройте в программе **Google Earth Pro** файл **KML** с точками фототриангуляции. Для просмотра нам потребуется снимок QuickBird за 20 апреля 2006 года (как самый хронологически близкий к 1970), который можно включить кнопкой ![](images\Ref03\Hystorical.png).


![Опорные точки на снимке QuickBird за 20 апреля 2006 года](images\Ref03\QB2006.png)


Следует иметь в виду, что координаты этих точек достаточно точно уравнены между собой, но снимок сам по себе может быть аффинно сдвинут на некую постоянную величину. Нам необходимо получить координаты этих точек в проекции UTM. Для переключения показа координат в UTM зайдите в меню **Инструменты – Настройки** и выберите соответствующий пункт в разделе **Показывать шир/долг**.


![Настройки показа координат](images\Ref03\GE_Settings.png)


Теперь, если вы правой кнопкой мыши щёлкните по опорной точке и из меню выберите **Свойства**, перед вами откроется окно с координатами восточного и северного склонения для точки.

Для добавления опорных точек в программе **E-foto** в меню проекта перейдите в раздел **Points** и нажмите на кнопку **New**. В открывшемся окне задайте имя опорной точки, впишите координаты её координаты из **Google Earth**. Высоту точки возьмите с топографической карты, зная, что сечение основных горизонталей 2 метра. Для плановых координат указывается стандартное отклонение 3 метра (это худшее возможное значение согласно некоторым исследованиям [[1](https://www.researchgate.net/publication/332438341_Positional_Accuracy_Testing_of_Google_Earth){target="_blank"}, [2](https://www.tandfonline.com/doi/abs/10.3846/20296991.2017.1330767){target="_blank"}]). Для высот укажите СКО в 2 метра.

Опорная точка | Описание точки на АФС      
--------------|--------------------------------------------
p1            |`Северо-восточный угол сельского клуба в Сатино`            
p2            |`Северо-западный угол сатинского ~~храма~~ магазина`            
p3            |`Северо-западный угол пруда в Ивановском`            
p4            |`Угол леса в районе Бутовского холма`
p10           |`Северо-восточный угол забора садов в Рыжково` 
p11           |`Юго-восточный угол пристройки коровника в Загрязье`
p12           |`Юго-западный угол коровника в Ивановском`
p13           |`Внутренний угол забора садового участка в Сатино`
p14           |`Юго-восточный угол залежной полосы на склоне южнее урочища Вторые Столбцы`
p15           |`Северный угол островка леса на Дедюевском холма, соответствующий краю развилки дорог`
p16           |`Одиноко стоящее дерево в верховьях Антоновской балки`
p17           |`Юго-восточный угол пруда в Медвежьем болоте`
p18           |`Западный угол пожарного пруда в Рыжковской излучине`
p19           |`Поворот дороги вдоль юго-восточного угла леса`
p20           |`Северо-западный угол храма в Беницах`

Внесите информацию об опорных точках и сохраните проект.

## Внешнее ориентирование {#stereo-exterior}
[В начало справки ⇡](#stereo)

Для внешнего ориентирования с помощью обратной фотограмметрической засечки в меню выберите пункт **Execute – Spatial Resection**. Аналогично внутреннему ориентированию откроется окно с выбором снимка. Далее откроется снимок с таблицей опорных точек внизу. Аналогично расстановке координатных меток установите опорные точки на снимке с помощью кнопки **Measure** ![](images\Ref03\Measure.png). Пропускайте те точки, которые отсутствуют на данном снимке. Для исключения опорной точки из засечки нажмите на крестик ![](images\Ref03\Exclusion.png). После расстановки всех опорных точек на снимке нажмите на ![](images\Ref03\Execute_EO.png), согласитесь со всеми параметрами точности, после чего перед вами откроется отчёт об уравнивании с параметрами внешнего ориентирования и матрицей вариации-ковариации.


![Окно отчёта уравнивания параметров внешнего ориентирования](images\Ref03\EO_Report.png)


Обратите внимание, что значение координаты Z должно быть около 1600 м, значения углов должны быть маленькими. Если параметры точности в матрице достаточны, то вы сможете нажать на кнопку **Accept** – параметры внешнего ориентирования будут сохранены. После этого нажмите на кнопку **Done** ![](images\Ref03\Done.png), что вернёт вас в основное окно проекта. Проделайте аналогичные операции для остальных снимков.


## Работа в стереокомпараторе {#stereo-stereoplotter}
[В начало справки ⇡](#stereo)

В меню проекта выберите пункт **Execute – Stereo Plotter**. Откроется окно с анаглифными изображением стереопары снимков. Для эффективной работы с анаглифами рекомендуется использовать специальные очки.


![Окно стереокомпаратора](images\Ref03\Stereoplotter.png)


Если изображение в анаглифических очках двоится, зажмите **SHIFT** и подвиньте изображение до тех пор, пока рассматриваемый участок не сольётся в объёмное изображение. Для измерения высоты в точке нужно добавить точку с помощью кнопки ![](images\Ref03\Add_Point.png), далее выбрать кнопку ![](images\Ref03\Measure.png). При устранённых параллаксах (восстановленной стереомодели на данную территорию) с помощью колеса мыши нужно посадить марку на измеряемый объект. На увеличенных фрагментах левого и правого изображения снизу будут показываться эти марки в «монокулярном» режиме. Как только мнимая марка слилась (реальные марки оказались на соответственных точках), нажмите левую кнопку мыши и в окне справа появятся измерения для данной точки. В случае, если вы замечаете поперечный параллакс, необходимо зажать **CTRL** и крутить колесо мыши до тех пор, пока поперечный параллакс не станет равен нулю.

Результаты измерений можно экспортировать в виде текстового файла, нажав на кнопку ![](images\Ref03\Export.png).

----
_Карпачевский А.М._ **Фотограмметрия и основы дистанционного зондирования**. М.: Географический факультет МГУ, `r lubridate::year(Sys.Date())`.
----