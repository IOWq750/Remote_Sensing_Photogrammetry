# Создание ЦМР и ЦМП, ортотрансформация на основе стереопары АФС в ЦФС PHOTOMOD {#photomod_DEM}


## Автоматический расчёт пикетов {#photomod_DEM-pikets}
[В начало справки ⇡](#photomod_DEM)


Создайте слой сетки через главное меню **Сетка – Создать**. В диспетчере слоёв появится новый слой. Убедитесь в том, что он редактируем и с зажатой клавишей **shift**  выделите прямоугольную область на нужную территорию. Зайдите в свойства слоя и задайте шаг сетки в **15 м**, а **Уровень Z**  выставьте равным 0.


![Свойства сетки](images\Ref16\Grid_Properties.png)


Созданная сетка будет использована для построения пикетов.Откройте окно автоматического расчета пикетов **ЦМР – Пикеты – Расчёт пикетов**. Выберите конфигурацию коррелятора **Сельская местность2**, укажите необходимую область поиска, начальное приближение установите равным средней высоте стереопары. Обратите внимание, что рассчитанные пикеты должны сохраняться в отдельный слой.


![Окно расчёта пикетов](images\Ref16\Piket_Calculation.png)


## Построение и редактирование модели TIN {#photomod_DEM-TIN}
[В начало справки ⇡](#photomod_DEM)


Одно из моделей представления высот – нерегулярная сеть триангуляции (TIN). Откройте панель инструментов **TIN**. Нажмите на кнопку **Построить TIN по пикетам и структурным линиям**. выберите необходимые слои и запустите процесс.


![Сеть TIN и квазигоризонтали](images\Ref16\TIN.png)

## Построение матрицы высот цифровой модели поверхности и горизонталей {#photomod_DEM-H_matrix}
[В начало справки ⇡](#photomod_DEM)


Убедитесь, что слой TIN открыт на редактирование. В главном меню вызовите **Матрица высот – Построить матрицу высот – По TIN**, укажите размер ячейки матрицы высот и сохраните результат в папке проекта.


Откройте ранее созданный слой с матрицей высот. В главном меню вызовите **Векторы - Построить горизонтали - По матрице высот**. В открывшемся окне установите опцию **Сглаживать**, уровень сглаживания 1.0, размер апертуры 21x21, начальный уровень 0.0, шаг 5.0 м, утолщенные горизонтали – каждые 25 м, опция «сглаживание» (ползунок чуть правее середины). Нажмите ОК. Сохраните слой с горизонталями папке **Data** вашего проекта.


## Ортотрансформация на основе полученной ЦМП {#photomod_DEM-Orthorectification}
[В начало справки ⇡](#photomod_DEM)


Вызовите панель **Растры – Ортотрансформирование**. На схеме блока выделите снимок, с которым работаете. Далее на панели нажмите на кнопку **Открыть выделенное изображение** ![](images\Ref16\Select.png). Нажмите на кнопку **Обрезка краёв исходных изображений** ![](images\Ref16\Clip2.png) и укажите процент обрезки для ограничения вашей территории.


![Окно обрезки изображения для ортотрансформации](images\Ref16\Clip.png)


Обратите внимание, что для ортотрансформации сохраняется собственный проект. Для запуска процесса ортотрансформации нажмите на кнопку ![](images\Ref16\Run.png).


![Сопоставление трансформированного и ортотрансформированного снимка](images\Ref16\Comparison.gif)


## Построение структурных линий {#photomod_DEM-structure_lines}
[В начало справки ⇡](#photomod_DEM)


Для начала нужно создать векторный слой, куда будут сохраняться векторные объекты (**Векторы – Создать слой**). После этого в диспетчере слоёв появится соответствующий слой.


![Диспетчер слоёв](images\Ref16\Layers.png)


На панели окна стереопары найдите инструмент векторизации линий **Режим ввода незамкнутых линий** ![](images\Ref16\Polyline.png). Теперь вам необходимо векторизовать линии тальвегов и водоразделов в стереорежиме – установите маркер так, чтоб он слился в объемную марку (колёсиком мыши) и нажмите клавишей **Insert**. Если точка установлена неверно, её можно удалить клавишей **Delete**. Для завершения векторизации нажмите **Enter**. Сохраняйте полученные результаты векторизации, нажав правой кнопкой мыши по слою в диспетчере и сохранив данные в папку проекта **Data**. Вы можете использовать режимом трассировки, который включается на панели **Векторы** кнопкой ![](images\Ref16\Tracing.png). В это режиме коррелятор автоматически сводит марку на поверхности модели. Вы можете настроить чувствительность коррелятора в **Сервис – Параметры – Коррелятор**.


Периодически сохраняйте векторный слой. Для этого правой кнопкой мыши щёлкните по слою и выберите пункт **Сохранить как...**. Сохраняйте данные в папке проекта.



## Фильтрация пикетов и построение цифровой модели рельефа {#photomod_DEM-DEM}
[В начало справки ⇡](#photomod_DEM)


Сохраните слой с пикетами папке **Data** вашего проекта. Убедившись, что слой с пикетами открыт на редактирование, отфильтруйте пикеты, попавшие на деревья и строения. Для этого откройте окно **ЦМР – Пикеты – Фильтрация - Фильтр строений и растительности** и, оставив параметры по умолчанию, нажмите ОК. Удалите слои с непроверяемыми и удалёнными пикетами. Сохраните слой с отфильтрованными векторами в качестве отдельного слоя.


![Фильтрация пикетов](images\Ref16\Filtration.png)


Для дальнейшего построения ЦМР повторите шаги, которые вы делали при построении ЦМП, но в качестве исходных данных используйте отфильтрованные пикеты и структурные линии.


----
_Карпачевский А.М._ **Основы дистанционного зондирования и фотограмметрии**. М.: Географический факультет МГУ, `r lubridate::year(Sys.Date())`.
----