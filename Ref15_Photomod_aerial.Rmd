---
title: "Ref15_Photomod_aerial"
output: html_document
---


# Обработка данных аэрофотосъёмки в ЦФС PHOTOMOD {#photomod}

## Установка программного обеспечения {#photomod-soft}
[В начало справки ⇡](#photomod)


Для практической работы вам понадобится цифровая фотограмметрическая система **PHOTOMOD**. Информацию о ней можно найти на домашнем сайте (https://racurs.ru/), там же можно скачать себе дистрибутив бесплатной версии программы, предварительно зарегистрировавшись.


## Исходные данные {#photomod-initial}
[В начало справки ⇡](#photomod)


В качестве исходных данных мы будем использовать серию аналоговых аэрофотоснимков на территорию WaldKirch (Германия).

[Снимки](https://disk.yandex.ru/d/vxx2kKksx5Hyfw){target="_blank"}

[Параметры камеры](https://disk.yandex.ru/d/7xvAgKMJ7xIavg){target="_blank"}

[Наземные опорные точки](https://disk.yandex.ru/d/ZFQWVoHlaKIGUA){target="_blank"}


## Создание проекта {#photomod-create_project}
[В начало справки ⇡](#photomod)


Запустите программу **PHOTOMOD 7 X64**. Если вы используете **Lite** версию, то откроется окно с информацией об усеченном функционале. Интерфейс программы представляет собой набор окон, например, окно главного меню, окно схемы блока, а также различные панели работы с данными. При запуске программы открывается окно управления проектами. Для создания проекта нажмите на соответствующую кнопку справа.


![Окно менеджера проекта](images\Ref15\Project_Manager.png)


Справа выберите путь для создания проекта. Обратите внимание, что по умолчанию предлагаются системные пути на диске C. вы можете создать новый путь, нажав на кнопку **Open Explorer** ![](images\Ref15\Open_Explorer.png), а затем на кнопку подключения ![](images\Ref15\Connect_Folder.png).


> Обратите внимание, что у программы есть свои особенности, связанные с сетевой структурой хранения данных, что может не позволить вам создать проект с произвольным путём не на диске C.


Заполните _Имя_ проекта, _Описание_. Если вы работаете с фотографическими снимками, выберите в _Тип_ **Центральная проекция**. Укажите правую декартовую систему координат – для этого нажмите на **Выбрать – Из БД – Международная**, в открывшемся окне найдите **Cartesian Right** (№142). Задайте амплитуду высот местности от 400 до 900 м. нажмите **ОК** для создания проекта.


## Внутреннее ориентирование {#photomod-interior_orientation}
[В начало справки ⇡](#photomod)


После этого перед вами откроется окно создания нового маршрута – можно согласиться с именем по умолчанию. _Маршрут_ – это совокупность снимков, полученных с одного галса залёта. Затем вы перейдёте к окну редактора блока снимков. _Блок снимков_ – это совокупность всех снимков, сделанных на изучамую территорию в течение залёта.


![Окно менеджера проекта](images\Ref15\Block_Editor.png)


Кнопки ![](images\Ref15\Add_Image1.png) и ![](images\Ref15\Add_Image2.png) предназначены для добавления снимков. Первая позволяет добавить файлы из любого места, а вторая – из подключенных папок, включая папку проект. Проще использовать вторую кнопку – для этого необходимо переместить данные в папку **Images** проекта (**C:/PHOTOMOD6.VAR/Profiles/%Имя профиля%/%Имя проекта%/Images**).


По умолчанию программа формирует накидной монтаж из снимков, состоящий из одного маршрута (в одну линию).


> Накидной монтаж – схематическое наложение снимков блока, исходя из их принадлежности к маршрутам, порядка съёмки, значений продольного и поперечного перекрытия.


Используемые снимки в именах файлов содержат информацию о принадлежности к маршрутам (число до символа '_') и порядковом номере снимка (число после символа '_'). Можно заметить, что используемые снимки относятся к маршрутам 2 и 3. В основном окне программы найдите меню **Блок – Разбить на маршруты – По именам снимков**.


![Разбивка по маршрутам](images\Ref15\Split_Block.png)


Поскольку маршрут 2 представляет собой галс обратного направления съёмки, необходимо его выделить в редакторе блока и нажать на кнопку изменения порядка изображений в маршруте ![](images\Ref15\Change_Direction.png). 


![Правильный порядок кадров в маршрутах блока](images\Ref15\Block_Editor2.png)


Откройте окно накидного монтажа в главном меню **Окна – Накидной монтаж** или нажав на кнопку ![](images\Ref15\Schematics_Button.png) в окне редактора блока. Задайте продольное и поперечное перекрытие в 65 и 43%, для предварительного внешнего ориентирования снимков выберите **Центры проекции и углы**. Нажмите на кнопку **Применить** и закройте окно, после чего накидной монтаж перестроится.


![Настройки накидного монтажа](images\Ref15\Schematics.png)


Далее необходимо задать параметры камеры, с помозью которой были сделаны кадры. Для этого в главном меню программы выберите пункт **Ориентирование – Управление камерами**. В открывшемся окне необходимо создать камеру, нажав на кнопку ![](images\Ref15\Create_Camera.png). Параметры камеры можно заполнить самостоятельно, а можно импортировать из файла, предоставленного в исходных данных.


_Камера_: RC_30
_Тип камеры_: аналоговая
_Единицы измерения_: мм
_Фокусное расстояние_: 153.5030
_Координаты главной точки_: X: 0.0020, Y: 0.0110
_Дисторсия_: Формула (физ.)
_Информация о метках_: Координаты меток


![Настройки накидного монтажа](images\Ref15\Camera.png)


После этого необходимо выделить все снимки в окне управления камерами проекта и убедиться в том, что стоит галка напротив опции **Присвоить выбранную камеру выбранным изображениям**. После закрытия окна камера присвоится ко всем снимкам.


В окне редактора блока выделите снимок **2_0710**, после чего в главном меню программы выберите **Ориентирование – Внутреннее ориентирование – Внутреннее ориентирование снимка**. Откроется окно для задания координатных меток снимков. Для ориентирования необходимо выбрать каждую строку координат из таблицы внизу и указать их положение на соответственных координатных метках. После установки маркера необходимо нажать на кнопку **Измерить метку**.

![Окно внутреннего ориентирования снимка](images\Ref15\Interior_Orientation.png)


> Для того, чтобы перемещать снимок, используйте зажатую клавишу **ALT**. Изменение масштаба осуществляется с помощью соответствующих кнопок над изображением.

После расстановки координатных меток снимка нажмите кнопку **Применить** и **OK**. Координатные метки на всех остальных снимках можно расставить автоматически. Выберите в главном меню **Ориентирование – Внутреннее ориентирование – Полуавтоматическое внутреннее ориентирование**. Выберите все изображения в окне, поставив напротив них галочки. Введите параметры размера области метки 101 и размер области поиска 201. Коэффициент корреляции 0,9. Аффинный тип преобразования. Нажмите выполнить. Появится сообщение о том, что найдены все метки на 5 изображениях. Нажмите ОК. Закройте окно полуавтоматического внутреннего ориентирования.


![Полуавтоматическое внутреннее ориентирование снимка](images\Ref15\Semi-Automate.png)


В окне управления камерами проекта вы можете увидеть знак + напротив каждого снимка в колонке внутреннего ориентирования. Можно ознакомиться с отчётом по внутреннему ориентированию. Выберите пункт главного меню **Ориентирование – Внутреннее ориентирование – Отчет по внутреннему ориентированию**, либо нажмите на кнопку ![](images\Ref15\Report_IO.png) в окне управления камерами. Необходимо убедиться, что ошибка по СКО у измеренных меток не больше 0,5 пиксела. При несоответствии ваших измерений этому допуску ошибка подсветится красным цветом. Отредактировать измерение можно, нажав на синюю звездочку в левом столбце таблицы отчета напротив измерения, превышающего допуск. После исправления возможных ошибок закройте окно отчета и окно управления камерами проекта.


## Измерение сети {#photomod-network_measurements}
[В начало справки ⇡](#photomod)


Выберите пункт главного меню **Ориентирование – Автоматическое измерение связующих точек – Аэросъёмка (Площадной коррелятор)**. Откроется окно, убедитесь, что параметры соответствуют тому, что указано на скриншоте. Нажмите **Выполнить**, по завершении операции нажмите **ОК** и закройте открывшийся отчёт.


![Окно автоматического измерения связующих точек](images\Ref15\Tie_Points.png)


Для перестройки накидного монтажа выберите пункт меню **Проект – Синхронизировать**


Далее импортируйте опорные точки в проект, выбрав пункт главного меню **Ориентирование – Каталог опорных точек**. В открывшемся окне нажмите на кнопку импорта ![](images\Ref15\Import_Points.png) и выберите файл **Waldkirch_GCP.csv**. В открывшемся окне убедитесь, что выбран правильный разделитель колонок, а также указана правильный порядковый номер строки, с которой начинает чтение файла. Колонки с данными должны соответствовать колонкам в окне.


![Окно импорта опорных точек](images\Ref15\Import_Points2.png)


Далее необходимо последовательно выбрать добавленные опорные точки в таблице и каждую измерить, нажав на кнопку **Найти/измерить точку** ![](images\Ref15\Measure_Point.png). После нажатия откроется окно со снимком. С помощью инструментов на верхней панели вы можете менять масштаб, а также премещаться между снимками накидного монтажа. Помните о том, что опорные точки, как правило, имеют свои проекции на нескольких снимках, но на данном этапе необходимо это сделать на одном снимке из блока.


![Окно измерения опорных точек](images\Ref15\Measure_Point2.png)


Изучите размещение опорных точек по рисунке ниже и найдите каждую. После нахождения точки и установки маркера в центр опознака необходимо нажать на кнопку **Переместить точку в положение маркера** ![](images\Ref15\Move_Point2Marker.png).


![Размещение опорных точек на снимке 0722](images\Ref15\Image_0722.png)


![Размещение опорных точек на снимке 0712](images\Ref15\Image_0712.png)


Далее приведены положения всех опорных точек в крупном масштабе. Обратите внимание, что каждая точка представляет собой опознак белого цвета с двумя перпендикулярными прямоугольниками.


![Схематичное изображение опознака](images\Ref15\Opoznak.png)


![Точка 40169P](images\Ref15\Point_40169P.png)


![Точка 6719](images\Ref15\Point_6719.png)


![Точка 6720](images\Ref15\Point_6720.png)


![Точка 779](images\Ref15\Point_779.png)


![Точка 970](images\Ref15\Point_970.png)


![Точка 163](images\Ref15\Point_163.png)


После измерения всех опорных точек на одном снимке нажмите кнопку **Применить**.


Для измерения остальных проекций точек на других снимках дважды щёлкните по точке в таблице. Откроются другие снимки, на которых эта точка должна присутствовать. Сделайте снимок, на котором точка была измерена в первый раз, левым, нажав на кнопку ![](images\Ref15\Make_Left.png). Поставьте маркер на правом снимке в нужное место и нажмите на кнопку **Коррелировать все с левым** ![](images\Ref15\Correlate.png). При правильной установке проекции опорной точки будет получен высокий коэффициент корреляции. По завершении работы со всеми точками нажмите **Применить** и **ОК**.


## Уравнивание сети {#photomod-network_adjustment}
[В начало справки ⇡](#photomod)


Запустите уравнивание блока в главном меню **Ориентирование – Уравнивание блока**.










 
----
_Карпачевский А.М._ **Основы дистанционного зондирования и фотограмметрия**. М.: Географический факультет МГУ, `r lubridate::year(Sys.Date())`.
----